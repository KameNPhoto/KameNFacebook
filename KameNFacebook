#!/usr/bin/env php
<?php

require_once __DIR__ . '/Facebook/autoload.php';

if (file_exists(__DIR__ . '/config.php')) { include __DIR__ . '/config.php'; } else { die('Could not load config'.PHP_EOL); }

if (file_exists(__DIR__ . '/album.php'))  { include __DIR__ . '/album.php'; }
if (file_exists(__DIR__ . '/auth.php'))   { include __DIR__ . '/auth.php'; }
if (file_exists(__DIR__ . '/base.php'))   { include __DIR__ . '/base.php'; }

# Token to access FB
$config['accessToken'] = ''; $config['pageToken'] = '';
if (file_exists(__DIR__ . '/token.php')) { include __DIR__ . '/token.php'; }
if ($config['accessToken'] == '') { getAccessToken(); }
if ($config['pageToken'] == '')   { getPageToken(); }

echo "+------------------+\n";
echo "| Liste des albums |\n";
echo "+------------------+\n";
$uri = "https://graph.facebook.com/".$config['version']."/me/albums?fields=name,id,can_upload,count";
$ret = doGetRequest($uri, $config['pageToken']);
foreach ($ret['data'] as $key=>$value) {
  if ($value['can_upload']) {
    echo $value['id']." -> ".$value['name']." (".$value['count'].")\n";
  }
}

$resp = true;
echo "Which album do you want to upload photos ? (type NEW to create a new album).\n";
while ($resp) {
  $handle = fopen ("php://stdin","r");
  $line = fgets($handle);
  if(trim($line) === 'NEW'){
    $albumId = createAlbum();
  } else {
    $albumId = trim($line);
  }
  if (checkAlbumId($albumId)) {
    $resp = false;
  } else {
    echo "An error occured. Please enter NEW or a correct album ID.\n";
  }
  fclose($handle);
}
$ret = uploadPhotosToAlbum($albumId);




exit() ;

#####################################################
#####################################################
#####################################################
#####################################################
#####################################################
#####################################################

$uri = "https://graph.facebook.com/$version/$pageID";
$curl = curl_init($uri);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl, CURLOPT_HTTPHEADER, array("Authorization: OAuth $accessToken"));
$return = curl_exec($curl);
curl_close($curl);

echo "------------------------------------------------------------------------------------------------------\n";
echo var_dump(json_decode($return, true));
echo "\n";
echo "------------------------------------------------------------------------------------------------------\n";

$uri = "https://graph.facebook.com/$version/me/accounts";
$curl = curl_init($uri);
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
curl_setopt($curl, CURLOPT_HTTPHEADER, array("Authorization: OAuth $accessToken"));
$return = curl_exec($curl);
curl_close($curl);

echo "------------------------------------------------------------------------------------------------------\n";
echo var_dump(json_decode($return, true));
echo "\n";
echo "------------------------------------------------------------------------------------------------------\n";

